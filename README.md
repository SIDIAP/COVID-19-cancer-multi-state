# Risks of COVID-19 diagnosis, hospitalisation and death in patients with cancer using a Multi-state model
This study has been performed using data from the Sistema d’Informació pel Desenvolupament de la Investigació a l’Atenció Primària (SIDIAP) database, linked to COVID-19 PCR testing, hospitalisation, and mortality data, which was mapped to the Observational Medical Outcomes Partnership (OMOP) Common Data Model (CDM). There are two distinct parts to the data analysis. First, creating cohort definitions for identifying particular comorbidities of interest. Second, bespoke R analysis code to execute the study.

Cohort definitions
diagCOVID is a CohortDiagnostics-type package. This was used to assess cohort definitions, and insert these cohorts into the results schema of the CDM. The results from the diagnostics can be viewed at https://livedataoxford.shinyapps.io/MultiStateCovidCohorts/, with the cohort definitions available in inst/cohorts folder of the package.
Note, to view/edit/reuse the cohort definitions you can use OHDSI ATLAS, with a public version available here. To load a specific cohort, copy the json file from inst/cohorts, navigate to Cohort Definitions in Atlas, create a new cohort, go to the JSON tab, paste the definition, and click reload. You can then inspect the cohort definition, edit, and reuse in the creation of subsequent study packages. Reuse does come though with the caveat that we strongly recommend you to first assess whether the definition is appropriate given your source data.

R analysis files
The first analysis file is "data preparation" which prepares the data for analysis (the end result being one wide, patient-per-row dataframe, and multiple dataframes created using the mstate package for considering each of the transitions of interest).
Subssequent Rmakdown files were created for analysing the observed data (with a html report that can be previewed here), modelling the relationship between history of cancer and transitions of interest, overall and stratified by years since cancer diagnosis, age, sex, and cancer types. Both the RMD file and the html file (where the uderlying code can also be seen, along with the output) are made available.The code for sensitivy analyses is also provided.
