# Risks of COVID-19 diagnosis, hospitalisation and death in patients with cancer using a Multi-state model
This study has been performed using data from the Sistema d’Informació pel Desenvolupament de la Investigació a l’Atenció Primària (SIDIAP) database, linked to COVID-19 PCR testing, hospitalisation, and mortality data, which was mapped to the Observational Medical Outcomes Partnership (OMOP) Common Data Model (CDM). There are two distinct parts to the data analysis. First, creating cohort definitions for identifying particular comorbidities of interest. Second, bespoke R analysis code to execute the study.

Cohort definitions
diagCOVID is a CohortDiagnostics-type package. This was used to assess cohort definitions, and insert these cohorts into the results schema of the CDM. The results from the diagnostics can be viewed at https://livedataoxford.shinyapps.io/MultiStateCovidCohorts/, with the cohort definitions available in inst/cohorts folder of the package.
Note, to view/edit/reuse the cohort definitions you can use OHDSI ATLAS, with a public version available here. To load a specific cohort, copy the json file from inst/cohorts, navigate to Cohort Definitions in Atlas, create a new cohort, go to the JSON tab, paste the definition, and click reload. You can then inspect the cohort definition, edit, and reuse in the creation of subsequent study packages. Reuse does come though with the caveat that we strongly recommend you to first assess whether the definition is appropriate given your source data.

R analysis files
The first analysis folder is "Data preparation" which prepares the data for analysis. Patients with cancer were identified using ICD10-CM codes (which can be found in the ConceptSets folder).
Descriptive analysis include descritptive characteristics at baseline and by transition, and visual inspection of proportionality of hazards, with html reports that can be previewed. 
Main analyses include Rmarkdown and html reports for 0) AICS and BICS for fitting age;  and models analysing the association between cancer and COVID-19 outcomes: 1) using different adjustment strategies, 2) stratifying by years since cancer diagnosis, sex, and age, 3) stratifying by years since cancer diagnosis, and cancer type (solid/hematological), and 4) stratifying by years since cancer diagnosis and solid cancer types.
The code for sensitivy analyses 1) restricting participants to never smokers, 2) stratifying by calendar time, and 3) using multiple imputation on variables with missing data is also provided.
